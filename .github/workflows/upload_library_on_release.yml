name: Upload library to the release

on:
  release:
    types:
      - published

jobs:
  build:
    runs-on: ubuntu-latest

    steps: 
    
      - name: 🛎 Checkout repo
        uses: actions/checkout@v2
        with: 
          fetch-depth: 0
          
      - name: ⚙️ Get previous last tag.
        id: version
        run: |
          lastTag=`git tag -l --sort=-creatordate --format='%(refname:short)' | head -n 1`
          echo "::set-output name=tag::$lastTag"
          
      - name: 💾 7Zip library
        run: 7z a -t7z -mx=9 MMLibrary.7z ./library/GhTools ./library/DynTools ./library/installation.txt
      
      - name: 📤 Upload library to release
        uses: svenstaro/upload-release-action@v1-release
        with:
          repo_token: ${{ secrets.GITHUB_TOKEN }}
          tag: ${{ steps.get_release.outputs.tag_name }}
          file: MMLibrary.7z
          asset_name: MMLibrary.7z
          overwrite: false
